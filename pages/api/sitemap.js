import { createClient } from '@supabase/supabase-js';\n\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n);\n\nexport default async function handler(req, res) {\n  const baseUrl = 'https://fstarot.com';\n\n  const { data: readers } = await supabase\n    .from('readers')\n    .select('alias, updated_at');\n\n  const { data: categories } = await supabase\n    .from('categories')\n    .select('slug, updated_at');\n\n  let urls = [];\n\n  urls.push({\n    url: baseUrl,\n    lastmod: new Date().toISOString(),\n  });\n\n  if (categories) {\n    categories.forEach(cat => {\n      urls.push({\n        url: baseUrl + '/' + cat.slug,\n        lastmod: (cat.updated_at || new Date()).toISOString(),\n      });\n    });\n  }\n\n  if (readers) {\n    readers.forEach(reader => {\n      urls.push({\n        url: baseUrl + '/reader/' + reader.alias,\n        lastmod: (reader.updated_at || new Date()).toISOString(),\n      });\n    });\n  }\n\n  let xml = '<?xml version="1.0" encoding="UTF-8"?>\n';\n  xml += '<urlset xmlns="https://www.sitemaps.org/schemas/sitemap/0.9">\n';\n\n  urls.forEach(u => {\n    xml += '  <url>\n';\n    xml += '    <loc>' + u.url + '</loc>\n';\n    xml += '    <lastmod>' + u.lastmod + '</lastmod>\n';\n    xml += '  </url>\n';\n  });\n\n  xml += '</urlset>';\n\n  res.setHeader('Content-Type', 'application/xml');\n  res.status(200).send(xml);\n}